<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backend Configuration Admin</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #f0f2f5;
            padding: 20px;
        }

        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
        }

        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 16px;
        }

        .backend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .backend-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .backend-card:hover {
            border-color: #007bff;
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.15);
        }

        .backend-card.active {
            border-color: #28a745;
            background: #f8fff9;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #007bff;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #1e7e34;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .add-backend {
            background: #e8f4fd;
            border: 2px dashed #007bff;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .add-backend:hover {
            background: #d1ecf1;
            border-color: #0056b3;
        }

        .add-backend h3 {
            color: #007bff;
            margin-bottom: 10px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 6px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.success {
            background: #28a745;
        }

        .notification.error {
            background: #dc3545;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #007bff;
            text-decoration: none;
            font-weight: bold;
        }

        .back-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <a href="rtmp-control-panel.html" class="back-link">‚Üê Back to Control Panel</a>
        
        <div class="header">
            <h1>üîß Backend Configuration Admin</h1>
            <p>Manage your backend servers and configurations</p>
        </div>

        <div class="backend-grid" id="backendGrid">
            <!-- Backend cards will be populated here -->
        </div>

        <div class="add-backend" onclick="addNewBackend()">
            <h3>+ Add New Backend</h3>
            <p>Click to add a new backend configuration</p>
        </div>
    </div>

    <script>
        class BackendAdmin {
            constructor() {
                this.backends = this.loadBackends();
                this.currentActive = localStorage.getItem('selectedBackend') || 'local';
                this.render();
            }

            loadBackends() {
                const defaultBackends = {
                    rdp: {
                        name: 'RDP Backend',
                        url: 'https://45.76.80.59:3006',
                        websocket: 'wss://45.76.80.59:3006',
                        type: 'rdp',
                        description: 'Remote Desktop Protocol server',
                        active: true
                    },
                    local: {
                        name: 'Local Development',
                        url: 'http://localhost:3005',
                        websocket: 'ws://localhost:3005',
                        type: 'local',
                        description: 'Local development server',
                        active: false
                    },
                    redis: {
                        name: 'Redis Backend',
                        url: 'https://your-redis-backend.vercel.app',
                        websocket: 'wss://your-redis-backend.vercel.app',
                        type: 'redis',
                        description: 'Vercel + Redis deployment',
                        active: false
                    },
                    vpc: {
                        name: 'VPC Backend',
                        url: 'https://your-vpc-backend.com',
                        websocket: 'wss://your-vpc-backend.com',
                        type: 'vpc',
                        description: 'Private cloud deployment',
                        active: false
                    }
                };

                const saved = localStorage.getItem('backendConfigs');
                return saved ? JSON.parse(saved) : defaultBackends;
            }

            saveBackends() {
                localStorage.setItem('backendConfigs', JSON.stringify(this.backends));
                // Also update the main backend manager
                if (window.opener && window.opener.backendManager) {
                    window.opener.backendManager.configs = this.backends;
                }
            }

            render() {
                const grid = document.getElementById('backendGrid');
                grid.innerHTML = '';

                Object.entries(this.backends).forEach(([key, backend]) => {
                    const card = this.createBackendCard(key, backend);
                    grid.appendChild(card);
                });
            }

            createBackendCard(key, backend) {
                const card = document.createElement('div');
                card.className = `backend-card ${this.currentActive === key ? 'active' : ''}`;
                
                card.innerHTML = `
                    <div class="card-header">
                        <div class="card-title">${backend.name}</div>
                        <div class="status-badge ${this.currentActive === key ? 'status-active' : 'status-inactive'}">
                            ${this.currentActive === key ? 'ACTIVE' : 'INACTIVE'}
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Backend Name</label>
                        <input type="text" value="${backend.name}" onchange="admin.updateBackend('${key}', 'name', this.value)">
                    </div>
                    
                    <div class="form-group">
                        <label>Backend URL</label>
                        <input type="url" value="${backend.url}" onchange="admin.updateBackend('${key}', 'url', this.value)">
                    </div>
                    
                    <div class="form-group">
                        <label>WebSocket URL</label>
                        <input type="text" value="${backend.websocket}" onchange="admin.updateBackend('${key}', 'websocket', this.value)">
                    </div>
                    
                    <div class="form-group">
                        <label>Description</label>
                        <input type="text" value="${backend.description}" onchange="admin.updateBackend('${key}', 'description', this.value)">
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="admin.testConnection('${key}')">Test Connection</button>
                        <button class="btn btn-success" onclick="admin.setActive('${key}')">Set Active</button>
                        ${key !== 'local' ? `<button class="btn btn-danger" onclick="admin.deleteBackend('${key}')">Delete</button>` : ''}
                    </div>
                `;

                return card;
            }

            updateBackend(key, field, value) {
                if (this.backends[key]) {
                    this.backends[key][field] = value;
                    this.saveBackends();
                    this.showNotification(`Updated ${field} for ${this.backends[key].name}`, 'success');
                }
            }

            async testConnection(key) {
                const backend = this.backends[key];
                try {
                    const response = await fetch(`${backend.url}/api/health`, { 
                        method: 'GET',
                        timeout: 5000 
                    });
                    
                    if (response.ok) {
                        this.showNotification(`‚úÖ ${backend.name} is online`, 'success');
                    } else {
                        this.showNotification(`‚ùå ${backend.name} responded with error: ${response.status}`, 'error');
                    }
                } catch (error) {
                    this.showNotification(`‚ùå Cannot connect to ${backend.name}`, 'error');
                }
            }

            setActive(key) {
                this.currentActive = key;
                localStorage.setItem('selectedBackend', key);
                this.render();
                this.showNotification(`Switched to ${this.backends[key].name}`, 'success');
            }

            deleteBackend(key) {
                if (key === 'local') return; // Don't delete local
                
                if (confirm(`Are you sure you want to delete ${this.backends[key].name}?`)) {
                    delete this.backends[key];
                    
                    if (this.currentActive === key) {
                        this.currentActive = 'local';
                        localStorage.setItem('selectedBackend', 'local');
                    }
                    
                    this.saveBackends();
                    this.render();
                    this.showNotification('Backend deleted', 'success');
                }
            }

            addBackend(name, url, websocket, description) {
                const key = name.toLowerCase().replace(/\s+/g, '_');
                
                this.backends[key] = {
                    name,
                    url,
                    websocket,
                    type: 'custom',
                    description
                };
                
                this.saveBackends();
                this.render();
                this.showNotification(`Added ${name}`, 'success');
            }

            showNotification(message, type = 'success') {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => notification.style.transform = 'translateX(0)', 100);
                setTimeout(() => {
                    notification.style.transform = 'translateX(400px)';
                    setTimeout(() => document.body.removeChild(notification), 300);
                }, 3000);
            }
        }

        function addNewBackend() {
            const name = prompt('Backend Name (e.g., "My RDP Server"):');
            if (!name) return;
            
            const url = prompt('Backend URL (e.g., "http://192.168.1.100:3005"):');
            if (!url) return;
            
            const websocket = prompt('WebSocket URL (e.g., "ws://192.168.1.100:3005"):');
            if (!websocket) return;
            
            const description = prompt('Description (optional):') || 'Custom backend server';
            
            admin.addBackend(name, url, websocket, description);
        }

        // Initialize admin
        const admin = new BackendAdmin();
    </script>
</body>
</html>
