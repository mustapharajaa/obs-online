<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>obs-online Browser streaming & rtmp  control</title>
    <link rel="icon" type="image/svg+xml" href="images/favicon.svg">
    <script src="js/backend-manager.js" defer></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #f0f2f5 url('images/continer-animation.gif');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            min-height: 100vh;
            padding: 20px;
            margin: 0;
        }

        .control-panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            max-width: 1200px;
            margin: 0 auto 40px auto;
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            grid-template-rows: auto 1fr;
            gap: 20px;
            overflow-y: auto;
        }

        .header {
            grid-column: 1 / -1;
            text-align: center;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 20px;
        }

        .header h1 {
            color: #333;
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 0.9rem;
        }

        /* Scroll Down Text */
        .scroll-down-text {
            background: #e8e8e8;
            color: #666;
            text-align: center;
            padding: 20px;
            font-size: 1.2rem;
            margin: 0;
        }

        /* Blue Textured Banner - Exact tovid.io copy */
        .notification-banner {
            background: linear-gradient(135deg, #2c5aa0 0%, #1e3a5f 50%, #0f2027 100%);
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(255,255,255,0.1) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(255,255,255,0.05) 0%, transparent 50%),
                linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.03) 50%, transparent 60%);
            color: white;
            padding: 60px 20px;
            text-align: left;
            position: relative;
            overflow: hidden;
        }

        .notification-banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                repeating-linear-gradient(
                    45deg,
                    transparent,
                    transparent 2px,
                    rgba(255,255,255,0.02) 2px,
                    rgba(255,255,255,0.02) 4px
                );
            pointer-events: none;
        }

        .notification-banner .banner-content {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 40px;
            position: relative;
            z-index: 1;
        }

        .notification-banner h2 {
            font-size: 48px;
            margin-bottom: 30px;
            font-weight: 300;
            font-family: 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.2;
            background: rgba(255,255,255,0.95);
            color: #333;
            padding: 8px 16px;
            display: inline-block;
            margin-right: 8px;
            margin-bottom: 8px;
        }

        .notification-banner p {
            font-size: 1.2rem;
            margin-bottom: 30px;
            opacity: 0.95;
        }

        .notification-form {
            display: flex;
            align-items: center;
            gap: 0;
            margin-top: 30px;
        }

        .notification-form input {
            padding: 12px 16px;
            border: none;
            border-radius: 0;
            font-size: 14px;
            width: 280px;
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: white;
            color: #666;
        }

        .notification-form input::placeholder {
            color: #999;
        }

        .notification-form button {
            padding: 12px 24px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 0;
            font-size: 14px;
            cursor: pointer;
            font-weight: 600;
            font-family: 'Helvetica Neue', Arial, sans-serif;
        }

        .notification-form button:hover {
            background: #219a52;
        }

        /* Branding Section - Above Banner */
        .branding-section {
            background: #e8e8e8;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            padding-left: 80px;
            padding-right: 80px;
        }

        .powered-by {
            display: flex;
            align-items: center;
            gap: 8px;
            background: white;
            padding: 12px 60px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            width: 300px;
        }

        .developed-with {
            color: #666;
            font-size: 1rem;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            background: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* Main Content Layout - Exact tovid.io copy */
        .main-content {
            background: #e8e8e8;
            padding: 40px 0 60px 0;
        }

        .content-wrapper {
            max-width: 1000px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 80px;
            padding: 0 40px;
        }

        .content-columns {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 60px;
        }

        .content-column {
            background: transparent;
        }

        .content-column h2 {
            font-size: 24px;
            color: #666;
            margin-bottom: 16px;
            font-weight: 300;
            font-family: 'Helvetica Neue', Arial, sans-serif;
        }

        .content-column p {
            font-size: 13px;
            line-height: 1.6;
            color: #666;
            margin-bottom: 16px;
            font-family: 'Helvetica Neue', Arial, sans-serif;
        }

        .content-column strong {
            color: #333;
            font-weight: 600;
        }

        .sidebar {
            padding-top: 0;
        }

        .sidebar h2 {
            font-size: 24px;
            color: #666;
            margin-bottom: 20px;
            font-weight: 300;
            font-family: 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.3;
        }

        .demo-video {
            width: 100%;
            height: 200px;
            background: #000;
            border-radius: 0;
            overflow: hidden;
            margin-bottom: 20px;
            position: relative;
        }

        .demo-video iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

/* Technology Section - Exact tovid.io copy */
.tech-section {
    background: #e8e8e8;
    color: #666;
    padding: 60px 0;
    position: relative;
    background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 400"><defs><linearGradient id="laptopGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:%23f0f0f0;stop-opacity:0.3"/><stop offset="100%" style="stop-color:%23d0d0d0;stop-opacity:0.1"/></linearGradient></defs><rect x="700" y="50" width="400" height="250" rx="8" fill="url(%23laptopGrad)" stroke="%23ccc" stroke-width="2"/><rect x="720" y="70" width="360" height="200" rx="4" fill="%23333"/><rect x="730" y="80" width="340" height="180" rx="2" fill="%23000"/><rect x="850" y="280" width="120" height="8" rx="4" fill="%23ddd"/></svg>');
    background-repeat: no-repeat;
    background-position: right center;
    background-size: contain;
}

        .tech-wrapper {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 40px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 80px;
            align-items: center;
        }

        .tech-content h2 {
            font-size: 48px;
            color: #666;
            margin-bottom: 30px;
            font-weight: 300;
            font-family: 'Helvetica Neue', Arial, sans-serif;
        }

        .tech-content p {
            font-size: 13px;
            line-height: 1.6;
            color: #666;
            margin-bottom: 16px;
            font-family: 'Helvetica Neue', Arial, sans-serif;
        }

        .tech-content a {
            color: #3498db;
            text-decoration: none;
        }

        .tech-content a:hover {
            text-decoration: underline;
        }

        .tech-image {
            text-align: right;
        }

        .tech-image img {
            max-width: 100%;
            height: auto;
        }

        .laptop-placeholder {
            display: none;
        }

        .tech-stack {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 30px 0;
        }

        .tech-item {
            background: rgba(255,255,255,0.1);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .contact-section {
            background: #ecf0f1;
            padding: 60px 0;
        }

        @media (max-width: 768px) {
            .notification-form {
                flex-direction: column;
            }

            .notification-form input {
                width: 100%;
                max-width: 300px;
            }

            .branding-section {
                flex-direction: column;
                text-align: center;
            }

            .content-wrapper {
                grid-template-columns: 1fr;
                gap: 40px;
                padding: 0 20px;
            }

            .content-columns {
                grid-template-columns: 1fr;
                gap: 40px;
            }

            .notification-banner h2 {
                font-size: 32px;
            }

            .notification-banner .banner-content {
                padding: 0 20px;
            }

            .tech-wrapper {
                grid-template-columns: 1fr;
                gap: 40px;
                text-align: center;
            }

            .tech-content h2 {
                font-size: 32px;
            }

            .laptop-placeholder {
                width: 300px;
                height: 180px;
                margin: 0 auto;
            }
        }

        .left-panel, .right-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
            min-height: 0;
        }

        .center-controls {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 15px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #ddd;
            min-width: 200px;
        }

        .section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #ddd;
        }

        .section h3 {
            color: #333;
            font-size: 1.2rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-icon {
            font-size: 1.4rem;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #007bff;
        }

        .platforms {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .platform-btn {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }

        .platform-btn:hover {
            border-color: #007bff;
            background: #f8f9ff;
        }

        .platform-btn.active {
            border-color: #007bff;
            background: #007bff;
            color: white;
        }

        .resolution-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .resolution-btn {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }

        .resolution-btn:hover {
            border-color: #007bff;
            background: #f8f9ff;
        }

        .resolution-btn.active {
            border-color: #007bff;
            background: #007bff;
            color: white;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-width: 160px;
        }

        .btn-primary {
            background: #28a745;
            color: white;
        }

        .btn-primary:hover {
            background: #218838;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        @media (max-width: 768px) {
            .control-panel {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto auto;
                height: auto;
                max-height: 95vh;
            }

            .center-controls {
                grid-row: 4;
            }

            .platforms {
                grid-template-columns: 1fr;
            }

            .resolution-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="control-panel">
        <div class="header">
            <h1><img src="images/Obs-Studio-Logo--Streamline-Logos.svg" alt="OBS" style="width: 32px; height: 32px; vertical-align: middle; margin-right: 10px;">obs-online remote control</h1>
            <div style="text-align: right; margin-top: 10px;">
                <a href="backend-admin.html" style="background: #007bff; color: white; padding: 8px 16px; text-decoration: none; border-radius: 6px; font-size: 14px;">‚öôÔ∏è Backend api</a>
            </div>
            <p>browser only fastest screen record to stream online</p>
        </div>

        <div class="left-panel">
            <!-- RTMP Configuration -->
            <div class="section">
                <h3><span class="section-icon">‚öôÔ∏è</span>RTMP Configuration</h3>
                <div class="form-group">
                    <label for="rtmpUrl">RTMP Server URL</label>
                    <input type="text" id="rtmpUrl" placeholder="rtmp://a.rtmp.youtube.com/live2">
                </div>
                <div class="form-group">
                    <label for="streamKey">Stream Key</label>
                    <input type="password" id="streamKey" placeholder="Your stream key">
                </div>
            </div>

            <!-- Website URL -->
            <div class="section">
                <h3><span class="section-icon">üåê</span>Website URL</h3>
                <div class="form-group">
                    <label for="websiteUrl">Target Website</label>
                    <input type="url" id="websiteUrl" placeholder="https://example.com" value="https://neal.fun">
                </div>
            </div>

            <!-- Popular Platforms -->
            <div class="section">
                <h3><span class="section-icon"><img src="images/platforms-logo.jpg" alt="Platforms" style="width: 120px; height: 36px; vertical-align: middle;"></span>Popular Platforms</h3>
                <div class="platforms">
                    <div class="platform-btn" data-platform="youtube" data-rtmp="rtmp://a.rtmp.youtube.com/live2">
                        <img src="images/YouTube-Logo.wine.svg" alt="YouTube" style="width: 32px; height: 32px; vertical-align: middle; margin-right: 8px;">YouTube Live
                    </div>
                    <div class="platform-btn" data-platform="twitch" data-rtmp="rtmp://live.twitch.tv/live">
                        <img src="images/Twitch_(service)-Logo.wine.svg" alt="Twitch" style="width: 24px; height: 24px; vertical-align: middle; margin-right: 8px;">Twitch
                    </div>
                    <div class="platform-btn" data-platform="facebook" data-rtmp="rtmps://live-api-s.facebook.com:443/rtmp">
                        <img src="images/2023_Facebook_icon.svg.png" alt="Facebook" style="width: 24px; height: 24px; vertical-align: middle; margin-right: 8px;">Facebook Live
                    </div>
                    <div class="platform-btn" data-platform="custom" data-rtmp="">
                        ‚öôÔ∏è Custom RTMP
                    </div>
                </div>
            </div>
        </div>

        <div class="center-controls">
            <button class="btn btn-primary" id="startStream">
                üöÄ Start Live Stream
            </button>
            <button class="btn btn-secondary" id="testConnection">
                üîç Test Connection
            </button>
            <button class="btn btn-danger" id="stopStream" style="display: none;">
                ‚èπÔ∏è Stop Stream
            </button>
            <div id="status" class="status" style="display: none;"></div>
            <div id="videoContainer" onclick="showVideoModal()" style="cursor: pointer; display: inline-block; margin-top: 180px; position: relative;">
                <iframe width="280" height="157" src="https://www.youtube.com/embed/nWG241oN7OQ" frameborder="0" loading="lazy" style="border-radius: 4px; pointer-events: none;"></iframe>
                <button onclick="hideVideoForever(event)" style="position: absolute; top: -8px; right: -8px; background: #ff4444; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; font-size: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 4px rgba(0,0,0,0.3);">√ó</button>
            </div>
        </div>

        <!-- Video Modal -->
        <div id="videoModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center;">
            <div style="position: relative; background: white; border-radius: 8px; padding: 20px;">
                <button onclick="hideVideoModal()" style="position: absolute; top: 10px; right: 15px; background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">√ó</button>
                <iframe width="800" height="450" src="https://www.youtube.com/embed/nWG241oN7OQ" frameborder="0" allowfullscreen loading="lazy" style="border-radius: 4px;"></iframe>
            </div>
        </div>

        <div class="right-panel">
            <!-- Resolution & Quality -->
            <div class="section">
                <h3><span class="section-icon"><img src="images/resolutionlogo.jpg" alt="Resolution" style="width: 28px; height: 28px; vertical-align: middle;"></span>Resolution & Quality</h3>
                
                <!-- Auto-Stop Duration -->
                <div class="form-group">
                    <label>‚è∞ Auto-Stop After</label>
                    <div style="display: flex; gap: 10px; align-items: center; justify-content: center;">
                        <div style="text-align: center;">
                            <input type="number" id="maxHours" min="0" max="9999" value="0" style="width: 80px; padding: 8px; border: 2px solid #ddd; border-radius: 6px; font-family: monospace; font-size: 16px; text-align: center; font-weight: bold;">
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">H</div>
                        </div>
                        <div style="text-align: center;">
                            <input type="number" id="maxMinutes" min="0" max="59" value="0" style="width: 60px; padding: 8px; border: 2px solid #ddd; border-radius: 6px; font-family: monospace; font-size: 16px; text-align: center; font-weight: bold;" oninput="if(this.value > 59) this.value = 59;">
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">M</div>
                        </div>
                    </div>
                    <small style="color: #666; font-size: 12px; text-align: center; display: block; margin-top: 8px;">Set both to 0 for 24/7 streaming</small>
                </div>
                
                <div class="resolution-buttons">
                    <div class="resolution-btn active" data-resolution="1280x720">
                        720p HD
                    </div>
                    <div class="resolution-btn" data-resolution="1920x1080">
                        1080p FHD
                    </div>
                </div>
                
                <br>
                
                <div class="form-group">
                    <label for="bitrate">Bitrate (kbps)</label>
                    <input type="number" id="bitrate" value="2500" min="500" max="8000" step="100">
                </div>
                <div class="form-group">
                    <label for="fps">Frame Rate (FPS)</label>
                    <input type="number" id="fps" value="15" min="10" max="60" step="5">
                </div>
            </div>

            <!-- Manage Browser -->
            <div class="section">
                <h3><span class="section-icon">üåê</span>Manage Browser</h3>
                
                <!-- Cookies File Management -->
                <div class="form-group">
                    <button type="button" onclick="editCookiesFile()" style="width: 100%; padding: 15px; background-color: #ff9800; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold;">
                        üç™ Manage Cookies
                    </button>
                </div>
                
                <!-- Browser State File Management -->
                <div class="form-group">
                    <button type="button" onclick="editBrowserStateFile()" style="width: 100%; padding: 15px; background-color: #007bff; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold;">
                        üåê Manage Browser Position
                    </button>
                </div>
                
                <!-- Enhanced File Editor Modal -->
                <div id="fileEditorModal" onclick="closeFileEditorOnOutsideClick(event)" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; backdrop-filter: blur(5px);">
                    <div id="modalContent" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(135deg, #ffffff, #f8f9fa); padding: 0; border-radius: 15px; width: 90%; max-width: 800px; max-height: 90%; box-shadow: 0 20px 40px rgba(0,0,0,0.3); border: 2px solid #e0e0e0; overflow: hidden;">
                        <!-- Header -->
                        <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px 30px; display: flex; align-items: center; justify-content: space-between;">
                            <h2 id="fileEditorTitle" style="margin: 0; font-size: 24px; font-weight: bold;">üìù Edit File</h2>
                            <button onclick="closeFileEditor()" style="background: rgba(255,255,255,0.2); border: none; font-size: 20px; cursor: pointer; color: white; padding: 8px 12px; border-radius: 50%; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">‚úñÔ∏è</button>
                        </div>
                        
                        <!-- Content Area -->
                        <div style="padding: 30px;">
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #555;">üìÑ File Content (JSON Format):</label>
                                <div style="background: #f5f5f5; padding: 10px; border-radius: 8px; margin-bottom: 10px; font-size: 12px; color: #666;">
                                    üí° <strong>Tip:</strong> Edit the JSON data below. Make sure to maintain proper JSON syntax with quotes around keys and values.
                                </div>
                            </div>
                            
                            <textarea id="fileEditorContent" placeholder="Enter your JSON data here..." style="width: 100%; height: 280px; font-family: 'Courier New', monospace; border: 2px solid #ddd; border-radius: 8px; padding: 15px; font-size: 14px; line-height: 1.5; background: #fafafa; resize: vertical; box-sizing: border-box;" spellcheck="false"></textarea>
                            
                            <div id="validationMessage" style="margin-top: 10px; padding: 10px; border-radius: 8px; display: none; font-weight: bold;"></div>
                        </div>
                        
                        <!-- Footer with Buttons -->
                        <div style="background: #f8f9fa; padding: 20px 30px; border-top: 1px solid #e0e0e0; display: flex; gap: 15px; justify-content: center;">
                            <button onclick="closeFileEditor()" style="padding: 15px 30px; background: linear-gradient(135deg, #f44336, #d32f2f); color: white; border: none; border-radius: 25px; cursor: pointer; font-size: 16px; font-weight: bold; box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3); transition: all 0.3s ease; min-width: 120px;" onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 6px 16px rgba(244, 67, 54, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(244, 67, 54, 0.3)'">‚ùå Cancel</button>
                            <button onclick="validateAndSave()" style="padding: 15px 30px; background: linear-gradient(135deg, #4CAF50, #45a049); color: white; border: none; border-radius: 25px; cursor: pointer; font-size: 16px; font-weight: bold; box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3); transition: all 0.3s ease; min-width: 120px;" onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 6px 16px rgba(76, 175, 80, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(76, 175, 80, 0.3)'">üíæ Save File</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Branding Section - Above Banner -->
    <div class="branding-section">
        <div class="powered-by">
            <img src="images/Badge 2.svg" alt="Powered by" style="width: 100%; height: 100%; object-fit: cover;">
        </div>
        <div class="developed-with">
            <div>Developed with <span style="color: #ff0000; font-weight: bold;">ffmpeg</span></div>
            <div><span style="color: #ff0000; font-weight: bold;">puppeteer</span> <a href="#tech-section" onclick="scrollToTech()" style="color: #3498db; font-size: 0.8rem; text-decoration: none; cursor: pointer;">more</a></div>
        </div>
    </div>

    <!-- Scroll Down Text -->
    <div class="scroll-down-text">
        There's more, scroll down ‚Üì
    </div>

    <!-- Notification Banner -->
    <div class="notification-banner">
        <div class="banner-content">
            <h2>We are revamping this service</h2>
            <h2>to stream via api, enhance browser positioning,</h2>
            <h2>include audio, offer API</h2>
            <div class="notification-form">
                <input type="email" placeholder="your@liveenity.com" id="notifyEmail">
                <button onclick="notifyMe()">Notify me</button>
            </div>
            <p style="margin-top: 20px; font-size: 14px; color: #ffcc00;">Please signup so we can notify you when we are ready.</p>
        </div>
    </div>

    <!-- Main Content Layout -->
    <div class="main-content">
        <div class="content-wrapper">
            <div class="content-columns">
                <div class="content-column">
                    <h2>Real-time streaming</h2>
                    <p>obs-online provides <strong>direct RTMP streaming</strong> from any website using Chrome DevTools and Puppeteer automation without creating intermediate files.</p>
                    
                    <p>Our patched puppeteer-screen-recorder library enables real-time browser capture with precise viewport control, scroll positioning, and cookie management for authenticated sessions.</p>
                    
                    <p>Multi-stream support allows concurrent streaming to multiple RTMP endpoints with unique stream IDs and real-time duration tracking via FFMPEG stderr parsing.</p>
                </div>

                <div class="content-column">
                    <h2>Browser automation</h2>
                    <p>Configure custom viewport dimensions, browser window positioning, and automated scroll control for optimal capture of any web content.</p>
                    
                    <p>Built-in cookie management handles authenticated sessions automatically, while comprehensive error handling ensures reliable streaming with retry logic.</p>
                    
                    <p>Stream at <strong>1080p FHD resolution</strong> with configurable frame rates (15fps default) and bitrate settings (2500kbps) optimized for stable RTMP delivery.</p>
                </div>

                <div class="content-column">
                    <h2>Remote control</h2>
                    <p>Monitor all active streams through the live dashboard at <strong>/lives</strong> with real-time duration updates and stream management controls.</p>

                    <p>Socket.IO integration provides instant communication between the control panel and streaming processes, eliminating the need for heavy desktop software like OBS.</p>
                    
                    <p>This service runs entirely in the browser with <strong>secure stream management</strong> - no credentials are stored, only temporary streaming permissions are granted.</p>
                </div>
            </div>

            <div class="sidebar">
                <h2>Here is an example stream produced with obs-online</h2>
                <div class="demo-video">
                    <iframe src="https://www.youtube.com/embed/Ow4lGuv7_Q4" frameborder="0" allowfullscreen loading="lazy"></iframe>
                </div>
            </div>
        </div>
    </div>

    <!-- Technology Section -->
    <div class="tech-section" id="tech-section">
        <div class="tech-wrapper">
            <div class="tech-content">
                <h2>Technology</h2>
                <p>obs.liveenity is powered by <a href="#">Node.js</a>, <a href="#">Puppeteer</a>, <a href="#">FFMPEG</a>, <a href="#">Socket.IO</a>, <a href="#">Express</a>, <a href="#">Chrome DevTools</a>, <a href="#">Puppeteer-Screen-Recorder</a>, <a href="#">Svelte-Browser</a>.</p>
                
                <p>obs.liveenity runs on a single smallest VPS on <a href="#">DigitalOcean</a>, a great cloud platform we also depend on in other projects for many years and do highly recommend!</p>
                
                <p>With our <a href="#">referral link</a> You receive a $100 60-day credit to try DigitalOcean. No strings attached.</p>
            </div>
            
            <div class="tech-image">
                <div class="laptop-placeholder">
                    üíª Streaming Technology
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Section -->
    <div class="contact-section">
        <h2>Contact</h2>
        <p>Email <a href="mailto:contact@liveenity.com">contact@liveenity.com</a>, Facebook <a href="#">group</a></p>
        
        or <a href="#" id="load-comments-btn" onclick="loadComments(); return false;" style="color: #3498db; text-decoration: underline; cursor: pointer;">load comments</a>.
        
        <div id="cusdis_thread"
            style="display: none; margin-top: 20px; max-width: 1200px; margin-left: auto; margin-right: auto;"
            data-host="https://cusdis.com"
            data-app-id="ecc7b4b7-8fa9-4910-b075-949187a1344d"
            data-page-id=""
            data-page-url=""
            data-page-title=""
            data-theme="dark"
        ></div>
    </div>

    <script>
        // Global notification function
        function showNotification(message, type) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : '#2196F3'};
                color: white;
                padding: 15px 20px;
                border-radius: 5px;
                z-index: 10000;
                font-weight: bold;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }

        // Global functions - accessible from anywhere
        async function notifyMe() {
            const email = document.getElementById('notifyEmail').value;
            if (!email || !email.includes('@')) {
                showNotification('‚ùå Please enter a valid email address.', 'error');
                return;
            }

            try {
                // Send to Vercel API endpoint
                const response = await fetch('/api/notify', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email })
                });

                const result = await response.json();

                if (response.ok) {
                    // Also store locally as backup
                    localStorage.setItem('notificationEmail', email);
                    console.log('Email successfully sent to API:', email);
                    showNotification('‚úÖ Thank you! We\'ll notify you when ready.', 'success');
                    document.getElementById('notifyEmail').value = '';
                } else {
                    throw new Error(result.error || 'Failed to register notification');
                }
            } catch (error) {
                console.error('Notification error:', error);
                console.log('Email saved locally as fallback:', email);
                // Fallback to localStorage if API fails
                localStorage.setItem('notificationEmail', email);
                showNotification('‚úÖ Success. We\'ll notify you when ready.', 'success');
                document.getElementById('notifyEmail').value = '';
            }
        }

        document.addEventListener('socketInitialized', () => {
            const socket = window.socket; // Use the globally initialized socket
            let currentEditingFile = ''; // Variable to track which file is being edited
        let isStreaming = false;

        // Platform selection
        document.querySelectorAll('.platform-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.platform-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                const rtmpUrl = btn.dataset.rtmp;
                if (rtmpUrl) {
                    document.getElementById('rtmpUrl').value = rtmpUrl;
                }
            });
        });

        // Resolution selection
        document.querySelectorAll('.resolution-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.resolution-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            });
        });

        // Status display
        function showStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
        }

        function setStreamingState(streaming) {
            isStreaming = streaming;
            document.getElementById('startStream').disabled = streaming;
            
            if (streaming) {
                document.getElementById('startStream').style.display = 'none';
                document.getElementById('stopStream').style.display = 'flex';
            } else {
                document.getElementById('startStream').style.display = 'flex';
                document.getElementById('stopStream').style.display = 'none';
            }
        }

        // Start streaming using Socket.IO (same as patched-rtmp-viewer.html)
        document.getElementById('startStream').addEventListener('click', () => {
            const rtmpUrl = document.getElementById('rtmpUrl')?.value || '';
            const streamKey = document.getElementById('streamKey')?.value || '';
            const websiteUrl = document.getElementById('websiteUrl')?.value || '';
            const bitrate = document.getElementById('bitrate')?.value || '2500';
            const fps = document.getElementById('fps')?.value || '15';
            const resolution = document.querySelector('.resolution-btn.active').dataset.resolution;
            // These fields were removed, set default values
            const scrollX = 0;
            const scrollY = 0;
            const zoomLevel = 1;
            const viewportWidth = 1920;
            const viewportHeight = 1080;

            if (!rtmpUrl || !streamKey || !websiteUrl) {
                showStatus('Please fill in all required fields', 'error');
                return;
            }

            showStatus('Starting stream...', 'info');
            
            // Get duration limit values
            const maxHours = parseInt(document.getElementById('maxHours')?.value || '0');
            const maxMinutes = parseInt(document.getElementById('maxMinutes')?.value || '0');
            let maxDuration = null;
            
            // Convert to seconds if values are set
            if (maxHours > 0 || maxMinutes > 0) {
                const totalSeconds = maxHours * 3600 + maxMinutes * 60;
                maxDuration = totalSeconds;
                console.log(`‚è∞ Stream will auto-stop after: ${maxHours}h ${maxMinutes}m (${totalSeconds} seconds)`);
            }

            const eventData = {
                url: websiteUrl,
                rtmpUrl: rtmpUrl,
                streamKey: streamKey,
                bitrate: parseInt(bitrate),
                fps: parseInt(fps),
                resolution: resolution,
                scrollX: parseInt(scrollX),
                scrollY: parseInt(scrollY),
                zoomLevel: parseInt(zoomLevel),
                maxDuration: maxDuration,
                viewportWidth: parseInt(viewportWidth),
                viewportHeight: parseInt(viewportHeight)
            };
            
            console.log('üì° Sending data to server:', eventData);
            socket.emit('startPatchedRTMPStream', eventData);
        });

        // Stop streaming using Socket.IO (same as patched-rtmp-viewer.html)
        document.getElementById('stopStream').addEventListener('click', () => {
            showStatus('Stopping stream...', 'info');
            // Use specific streamId like /lives page does
            if (window.currentStreamId) {
                socket.emit('stopStream', { streamId: window.currentStreamId });
            } else {
                socket.emit('stopStream', {});
            }
        });

        // Test connection
        document.getElementById('testConnection').addEventListener('click', () => {
            if (socket.connected) {
                showStatus('Server connection successful!', 'success');
            } else {
                showStatus('Server connection failed', 'error');
            }
        });

        // Socket event handlers (same as patched-rtmp-viewer.html)
        socket.on('streamStarted', (data) => {
            console.log('Stream started:', data);
            window.currentStreamId = data.streamId; // Store streamId for stopping
            setStreamingState(true);
            showStatus('Stream started successfully!', 'success');
            startDurationTimer();
        });

        socket.on('streamStopped', (data) => {
            console.log('Stream stopped:', data);
            setStreamingState(false);
            showStatus('Stream stopped', 'info');
            stopDurationTimer();
        });

        socket.on('streamAutoStopped', (data) => {
            console.log('Stream auto-stopped:', data);
            setStreamingState(false);
            showStatus(`Stream auto-stopped: ${data.reason} (${data.duration}/${data.maxDuration})`, 'info');
        });

        socket.on('streamError', (error) => {
            console.error('Stream error:', error);
            setStreamingState(false);
            showStatus('Error: ' + error, 'error');
            showStatus(`‚ùå Error: ${error}`, 'error');
            stopDurationTimer();
        });

        socket.on('connect', () => {
            console.log('üîå Socket.IO connected to server');
            showStatus('üîå Connected to server', 'success');
        });

        socket.on('disconnect', () => {
            console.log('üîå Socket.IO disconnected from server');
            setStreamingState(false);
            showStatus('üîå Disconnected from server', 'error');
        });

        socket.on('connect_error', (error) => {
            console.error('‚ùå Socket.IO connection error:', error);
            showStatus('‚ùå Connection error: ' + error.message, 'error');
        });

        // File Management Functions
        
        async function editCookiesFile() {
            try {
                const response = await fetch('/api/files/cookies.json');
                const data = await response.json();
                
                document.getElementById('fileEditorTitle').innerHTML = 'üç™ Edit Cookies File';
                document.getElementById('fileEditorContent').value = JSON.stringify(data, null, 2);
                document.getElementById('fileEditorModal').style.display = 'block';
                currentEditingFile = 'cookies.json';
                hideValidationMessage();
            } catch (error) {
                console.error('Error loading cookies file:', error);
                showNotification('Error loading cookies file: ' + error.message, 'error');
            }
        }

        async function editBrowserStateFile() {
            try {
                const response = await fetch('/api/files/browser-state-data.txt');
                const data = await response.json();
                
                document.getElementById('fileEditorTitle').innerHTML = 'üåê Edit Browser Position File';
                document.getElementById('fileEditorContent').value = JSON.stringify(data, null, 2);
                document.getElementById('fileEditorModal').style.display = 'block';
                currentEditingFile = 'browser-state-data.txt';
                hideValidationMessage();
            } catch (error) {
                console.error('Error loading browser state file:', error);
                showNotification('Error loading browser state file: ' + error.message, 'error');
            }
        }

        function closeFileEditor() {
            document.getElementById('fileEditorModal').style.display = 'none';
            currentEditingFile = null;
            hideValidationMessage();
        }

        function closeFileEditorOnOutsideClick(event) {
            // Only close if clicking on the modal background, not the modal content
            if (event.target.id === 'fileEditorModal') {
                closeFileEditor();
            }
        }

        function validateAndSave() {
            if (!currentEditingFile) return;
            
            try {
                const content = document.getElementById('fileEditorContent').value.trim();
                
                if (!content) {
                    showValidationMessage('File content cannot be empty!', 'error');
                    return;
                }
                
                // Validate JSON
                JSON.parse(content);
                showValidationMessage('‚úÖ JSON is valid! Saving...', 'success');
                
                setTimeout(() => saveFile(content), 500);
                
            } catch (error) {
                showValidationMessage('‚ùå Invalid JSON format: ' + error.message, 'error');
            }
        }

        async function saveFile(content) {
            try {
                const response = await fetch(`/api/files/${currentEditingFile}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ content: content })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('‚úÖ File saved successfully!', 'success');
                    closeFileEditor();
                } else {
                    showValidationMessage('‚ùå Error saving file: ' + result.message, 'error');
                }
            } catch (error) {
                showValidationMessage('‚ùå Network error: ' + error.message, 'error');
            }
        }

        function showValidationMessage(message, type) {
            const msgDiv = document.getElementById('validationMessage');
            msgDiv.textContent = message;
            msgDiv.style.display = 'block';
            msgDiv.style.backgroundColor = type === 'error' ? '#ffebee' : '#e8f5e8';
            msgDiv.style.color = type === 'error' ? '#c62828' : '#2e7d32';
            msgDiv.style.border = `2px solid ${type === 'error' ? '#f44336' : '#4caf50'}`;
        }

        function hideValidationMessage() {
            document.getElementById('validationMessage').style.display = 'none';
        }

        function showNotification(message, type) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed; top: 20px; right: 20px; z-index: 2000;
                padding: 15px 20px; border-radius: 8px; font-weight: bold;
                background: ${type === 'error' ? '#f44336' : '#4caf50'};
                color: white; box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                transform: translateX(400px); transition: transform 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => notification.style.transform = 'translateX(0)', 100);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.transform = 'translateX(400px)';
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }

        // Duration display functions
        let streamStartTime = null;
        let durationInterval = null;
        let maxDurationMs = null;

        function getDurationFromInputs() {
            const hours = parseInt(document.getElementById('maxHours').value) || 0;
            const minutes = parseInt(document.getElementById('maxMinutes').value) || 0;
            
            if (hours === 0 && minutes === 0) return null;
            
            return (hours * 3600 + minutes * 60) * 1000;
        }

        function startDurationTimer() {
            streamStartTime = Date.now();
            
            // Get max duration from inputs
            maxDurationMs = getDurationFromInputs();
            
            // Update duration every second
            durationInterval = setInterval(() => {
                if (streamStartTime) {
                    const elapsed = Date.now() - streamStartTime;
                    
                    // Check if max duration reached
                    if (maxDurationMs && elapsed >= maxDurationMs) {
                        showNotification('‚è∞ Auto-stopping stream - Duration limit reached!', 'info');
                        // Force stop the stream
                        if (window.currentStreamId) {
                            socket.emit('stopStream', { streamId: window.currentStreamId });
                        } else {
                            socket.emit('stopStream', {});
                        }
                        stopDurationTimer();
                    }
                }
            }, 1000);
        }

        function stopDurationTimer() {
            if (durationInterval) {
                clearInterval(durationInterval);
                durationInterval = null;
            }
            streamStartTime = null;
            maxDurationMs = null;
        }

        function updateLiveDuration(duration) {
            // Keep the client-side timer running, ignore server duration updates
            // This ensures continuous counting even if server updates are inconsistent
        }

        // Initial status
        showStatus('üîß Ready for RTMP streaming!', 'info');


        function scrollToTech() {
            document.getElementById('tech-section').scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }

        function showMoreTech() {
            alert('Complete technology stack:\n\n‚Ä¢ FFmpeg - Video processing\n‚Ä¢ Puppeteer - Browser automation\n‚Ä¢ Chrome DevTools - Screen capture\n‚Ä¢ Node.js - Server runtime\n‚Ä¢ Socket.IO - Real-time communication\n‚Ä¢ Express - Web framework\n‚Ä¢ RTMP - Streaming protocol');
            // Clear the input
            document.getElementById('notifyEmail').value = '';
        }

        // Video Modal Functions
        function showVideoModal() {
            document.getElementById('videoModal').style.display = 'flex';
        }

        function hideVideoModal() {
            document.getElementById('videoModal').style.display = 'none';
        }

        // Close modal when clicking outside
        document.getElementById('videoModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideVideoModal();
            }
        });

        // Hide video forever with cookie
        function hideVideoForever(event) {
            event.stopPropagation(); // Prevent modal from opening
            document.getElementById('videoContainer').style.display = 'none';
            // Set cookie to remember user's choice for 1 year
            document.cookie = "hideVideo=true; expires=" + new Date(Date.now() + 365*24*60*60*1000).toUTCString() + "; path=/";
        }

        // Check if video should be hidden on page load
        function checkVideoVisibility() {
            if (document.cookie.includes('hideVideo=true')) {
                document.getElementById('videoContainer').style.display = 'none';
            }
        }

        // Run on page load
        checkVideoVisibility();
        });
    </script>
    <script>
        let currentEditingFile = null;

        function openFileEditor(fileName, title) {
            currentEditingFile = fileName;
            document.getElementById('fileEditorTitle').innerText = title;

            if (!window.socket) {
                alert('Backend connection not ready. Please wait a moment and try again.');
                return;
            }

            window.socket.emit('get_file_content', { filename: fileName }, (response) => {
                if (response.error) {
                    console.error(`Error getting file content: ${response.error}`);
                    document.getElementById('fileEditorContent').value = `// Error: ${response.error}`;
                } else {
                    document.getElementById('fileEditorContent').value = response.content;
                }
                document.getElementById('fileEditorModal').style.display = 'flex';
            });
        }

        function editCookiesFile() {
            openFileEditor('cookies.json', 'üç™ Manage Cookies');
        }

        function editBrowserStateFile() {
            openFileEditor('browser-state-data.txt', 'üåê Manage Browser Position');
        }

        function closeFileEditor() {
            document.getElementById('fileEditorModal').style.display = 'none';
            currentEditingFile = null;
            document.getElementById('validationMessage').style.display = 'none';
        }

        function validateAndSave() {
            const content = document.getElementById('fileEditorContent').value;
            const validationMessage = document.getElementById('validationMessage');

            try {
                JSON.parse(content);
                validationMessage.style.display = 'none';

                if (!window.socket) {
                    alert('Backend connection not ready. Please wait a moment and try again.');
                    return;
                }

                window.socket.emit('save_file_content', { filename: currentEditingFile, content: content }, (response) => {
                    if (response.error) {
                        validationMessage.textContent = `Error saving: ${response.error}`;
                        validationMessage.style.background = '#f8d7da';
                        validationMessage.style.color = '#721c24';
                    } else {
                        validationMessage.textContent = '‚úÖ File saved successfully!';
                        validationMessage.style.background = '#d4edda';
                        validationMessage.style.color = '#155724';
                        setTimeout(closeFileEditor, 1500);
                    }
                    validationMessage.style.display = 'block';
                });

            } catch (e) {
                validationMessage.textContent = '‚ùå Invalid JSON format. Please correct it.';
                validationMessage.style.background = '#f8d7da';
                validationMessage.style.color = '#721c24';
                validationMessage.style.display = 'block';
            }
        }

        function closeFileEditorOnOutsideClick(event) {
            if (event.target.id === 'fileEditorModal') {
                closeFileEditor();
            }
        }
    </script>
    <!-- Enhanced File Editor Modal -->
    <div id="fileEditorModal" onclick="closeFileEditorOnOutsideClick(event)" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; backdrop-filter: blur(5px);">
        <div id="modalContent" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(135deg, #ffffff, #f8f9fa); padding: 0; border-radius: 15px; width: 90%; max-width: 800px; max-height: 90%; box-shadow: 0 20px 40px rgba(0,0,0,0.3); border: 2px solid #e0e0e0; overflow: hidden;">
            <!-- Header -->
            <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px 30px; display: flex; align-items: center; justify-content: space-between;">
                <h2 id="fileEditorTitle" style="margin: 0; font-size: 24px; font-weight: bold;">üìù Edit File</h2>
                <button onclick="closeFileEditor()" style="background: rgba(255,255,255,0.2); border: none; font-size: 20px; cursor: pointer; color: white; padding: 8px 12px; border-radius: 50%; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">‚úñÔ∏è</button>
            </div>
            
            <!-- Content Area -->
            <div style="padding: 30px;">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #555;">üìÑ File Content (JSON Format):</label>
                    <div style="background: #f5f5f5; padding: 10px; border-radius: 8px; margin-bottom: 10px; font-size: 12px; color: #666;">
                        üí° <strong>Tip:</strong> Edit the JSON data below. Make sure to maintain proper JSON syntax with quotes around keys and values.
                    </div>
                </div>
                
                <textarea id="fileEditorContent" placeholder="Enter your JSON data here..." style="width: 100%; height: 280px; font-family: 'Courier New', monospace; border: 2px solid #ddd; border-radius: 8px; padding: 15px; font-size: 14px; line-height: 1.5; background: #fafafa; resize: vertical; box-sizing: border-box;" spellcheck="false"></textarea>
                
                <div id="validationMessage" style="margin-top: 10px; padding: 10px; border-radius: 8px; display: none; font-weight: bold;"></div>
            </div>
            
            <!-- Footer with Buttons -->
            <div style="background: #f8f9fa; padding: 20px 30px; border-top: 1px solid #e0e0e0; display: flex; gap: 15px; justify-content: center;">
                <button onclick="closeFileEditor()" style="padding: 15px 30px; background: linear-gradient(135deg, #f44336, #d32f2f); color: white; border: none; border-radius: 25px; cursor: pointer; font-size: 16px; font-weight: bold; box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3); transition: all 0.3s ease; min-width: 120px;" onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 6px 16px rgba(244, 67, 54, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(244, 67, 54, 0.3)'">‚ùå Cancel</button>
                <button onclick="validateAndSave()" style="padding: 15px 30px; background: linear-gradient(135deg, #4CAF50, #45a049); color: white; border: none; border-radius: 25px; cursor: pointer; font-size: 16px; font-weight: bold; box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3); transition: all 0.3s ease; min-width: 120px;" onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 6px 16px rgba(76, 175, 80, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(76, 175, 80, 0.3)'">üíæ Save File</button>
            </div>
        </div>
    </div>
    <link rel="stylesheet" href="/css/cusdis-custom.css" media="print" onload="this.media='all'">
    
    <script>
        // Auto-resize iframe functionality
        window.addEventListener('message', function(event) {
            if (event.origin !== 'https://cusdis.com') return;
            
            // Handle different Cusdis message formats
            if (event.data && (event.data.type === 'cusdis' || event.data.from === 'cusdis')) {
                const iframe = document.querySelector('#cusdis_thread iframe');
                if (iframe) {
                    let height = event.data.height || event.data.data?.height;
                    if (height) {
                        iframe.style.height = height + 'px';
                        iframe.style.minHeight = height + 'px';
                    }
                }
            }
            
            // Also handle generic iframe resize messages
            if (event.data && typeof event.data === 'object' && event.data.height) {
                const iframe = document.querySelector('#cusdis_thread iframe');
                if (iframe && event.source === iframe.contentWindow) {
                    iframe.style.height = event.data.height + 'px';
                    iframe.style.minHeight = event.data.height + 'px';
                }
            }
        });
        
        function loadComments() {
            const cusdisThread = document.getElementById('cusdis_thread');
            const loadBtn = document.getElementById('load-comments-btn');
            
            if (cusdisThread) {
                // Show comments and hide button
                cusdisThread.style.display = 'block';
                loadBtn.style.display = 'none';
                
                // Set dynamic attributes
                cusdisThread.setAttribute('data-page-id', window.location.pathname);
                cusdisThread.setAttribute('data-page-url', window.location.href);
                cusdisThread.setAttribute('data-page-title', document.title);
                
                // Load Cusdis script
                if (!window.cusdisLoaded) {
                    const script = document.createElement('script');
                    script.async = true;
                    script.defer = true;
                    script.src = 'https://cusdis.com/js/cusdis.es.js';
                    document.head.appendChild(script);
                    window.cusdisLoaded = true;
                    
                    // Set up iframe auto-resize after script loads
                    script.onload = function() {
                        setTimeout(function() {
                            const iframe = document.querySelector('#cusdis_thread iframe');
                            if (iframe) {
                                iframe.style.width = '100%';
                                iframe.style.border = 'none';
                                iframe.style.background = 'transparent';
                                iframe.style.minHeight = '600px'; // Set initial minimum height
                                
                                // Force iframe to expand
                                const observer = new MutationObserver(function() {
                                    if (iframe.contentDocument) {
                                        const body = iframe.contentDocument.body;
                                        if (body) {
                                            const height = Math.max(body.scrollHeight, body.offsetHeight, 600);
                                            iframe.style.height = height + 'px';
                                        }
                                    }
                                });
                                
                                iframe.onload = function() {
                                    if (iframe.contentDocument) {
                                        observer.observe(iframe.contentDocument.body, {
                                            childList: true,
                                            subtree: true,
                                            attributes: true
                                        });
                                        
                                        // Initial height adjustment
                                        const body = iframe.contentDocument.body;
                                        if (body) {
                                            const height = Math.max(body.scrollHeight, body.offsetHeight, 600);
                                            iframe.style.height = height + 'px';
                                        }
                                        
                                        // Inject custom styles to make input fields smaller
                                        try {
                                            const style = iframe.contentDocument.createElement('style');
                                            style.textContent = `
                                                input.w-full.p-2.border.border-gray-200.bg-transparent,
                                                input[name="nickname"],
                                                input[name="email"],
                                                input[type="text"],
                                                input[type="email"] {
                                                    height: 28px !important;
                                                    min-height: 28px !important;
                                                    padding: 4px 8px !important;
                                                    font-size: 13px !important;
                                                    line-height: 1.2 !important;
                                                    box-sizing: border-box !important;
                                                }
                                                .grid.grid-cols-2 input,
                                                .grid input {
                                                    height: 28px !important;
                                                    min-height: 28px !important;
                                                    padding: 4px 8px !important;
                                                    font-size: 13px !important;
                                                }
                                                label.mb-2.block {
                                                    font-size: 12px !important;
                                                    margin-bottom: 3px !important;
                                                }
                                                .px-1 {
                                                    padding-left: 4px !important;
                                                    padding-right: 4px !important;
                                                }
                                            `;
                                            iframe.contentDocument.head.appendChild(style);
                                        } catch (e) {
                                            console.log('Could not inject styles due to cross-origin restrictions');
                                        }
                                    }
                                };
                            }
                        }, 1500);
                    };
                }
            }
        }
    </script>
</body>
</html>
